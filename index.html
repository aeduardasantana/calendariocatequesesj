<html><head><base href="https://catequese-sao-jose.example.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendário de Eventos - Catequese Capela São José</title>
<style>
    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f4f8;
        color: #333;
    }
    .container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: space-around;
    }
    .calendar-window {
        flex-basis: calc(50% - 20px);
        background-color: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
    }
    h2 {
        color: #3498db;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
    }
    th {
        background-color: #3498db;
        color: white;
    }
    tr:nth-child(even) {
        background-color: #f2f2f2;
    }
    .edit-btn, .block-btn {
        padding: 5px 10px;
        margin: 2px;
        cursor: pointer;
        border: none;
        border-radius: 3px;
        transition: background-color 0.3s;
    }
    .edit-btn {
        background-color: #2ecc71;
        color: white;
    }
    .block-btn {
        background-color: #e74c3c;
        color: white;
    }
    .edit-btn:hover {
        background-color: #27ae60;
    }
    .block-btn:hover {
        background-color: #c0392b;
    }
    .event-input, .time-input {
        width: 100%;
        padding: 5px;
        box-sizing: border-box;
    }
    .blocked {
        background-color: #ecf0f1;
        color: #7f8c8d;
    }
    .sunday {
        background-color: #d5e8f7;
    }
    .catechesis-mass {
        font-weight: bold;
        color: #e67e22;
    }
    .search-container {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
    }
    .search-input {
        width: 300px;
        padding: 10px;
        font-size: 16px;
        border: 2px solid #3498db;
        border-radius: 5px 0 0 5px;
        outline: none;
    }
    .search-button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 0 5px 5px 0;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .search-button:hover {
        background-color: #2980b9;
    }
    .highlight {
        background-color: yellow;
        font-weight: bold;
    }
    .month-dropdown, .month-content, .month-arrow {
        display: none;
    }
</style>
</head>
<body>
    <h1>Calendário de Eventos - Catequese Capela São José</h1>
    
    <div class="search-container">
        <input type="text" id="search-input" class="search-input" placeholder="Buscar eventos...">
        <button id="search-button" class="search-button">Buscar</button>
    </div>
    
    <div class="container">
        <div class="calendar-window">
            <h2>Eventos Gerais</h2>
            <div id="general-events"></div>
        </div>
        
        <div class="calendar-window">
            <h2>Preparação para Eucaristia</h2>
            <div id="eucharist-events"></div>
        </div>
        
        <div class="calendar-window">
            <h2>Crisma Jovem</h2>
            <div id="youth-confirmation-events"></div>
        </div>
        
        <div class="calendar-window">
            <h2>Crisma Adulto</h2>
            <div id="adult-confirmation-events"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/pt-br.js"></script>
    <script>
        moment.locale('pt-br');
        moment.updateLocale('pt-br', {
            longDateFormat: {
                L: 'DD/MM/YYYY'
            }
        });
        
        const windows = [
            { id: 'general-events', name: 'Eventos Gerais' },
            { id: 'eucharist-events', name: 'Preparação para Eucaristia' },
            { id: 'youth-confirmation-events', name: 'Crisma Jovem' },
            { id: 'adult-confirmation-events', name: 'Crisma Adulto' }
        ];

        function generateCalendar(startDate, endDate) {
            const start = moment(startDate);
            const end = moment(endDate);
            const calendar = [];

            while (start.isSameOrBefore(end)) {
                if (start.day() === 6 || start.day() === 0) {
                    const isSunday = start.day() === 0;
                    const isFirstSundayOfMonth = isSunday && start.date() <= 7;
                    const defaultEvent = isSunday ? (isFirstSundayOfMonth ? 'Missa da Catequese' : 'Missa') : '';
                    calendar.push({
                        date: start.format('DD/MM/YYYY'),
                        day: start.format('dddd'),
                        month: start.format('MMMM/YYYY').toUpperCase(),
                        events: [
                            defaultEvent,
                            '',  
                            '',  
                            isSunday ? defaultEvent : 'Encontro às 19h'
                        ],
                        times: isSunday ? ['9h30', '9h30', '9h30', '9h30'] : ['', '', '', '19h'],
                        blocked: [false, false, false, false],
                        isFirstSundayOfMonth: isFirstSundayOfMonth
                    });
                }
                start.add(1, 'day');
            }

            return calendar;
        }

        function renderCalendar(windowId, calendar) {
            const container = document.getElementById(windowId);
            container.innerHTML = '';

            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');

            thead.innerHTML = `
                <tr>
                    <th>Data</th>
                    <th>Dia</th>
                    <th>Evento</th>
                    <th>Horário</th>
                    <th>Ações</th>
                </tr>
            `;

            calendar.forEach((day, index) => {
                const tr = document.createElement('tr');
                const windowIndex = windows.findIndex(w => w.id === windowId);
                const isBlocked = day.blocked[windowIndex];
                const isSunday = day.day === 'domingo';
                const isFirstSundayOfMonth = day.isFirstSundayOfMonth;
                tr.innerHTML = `
                    <td>${day.date}</td>
                    <td>${day.day.charAt(0).toUpperCase() + day.day.slice(1)}</td>
                    <td class="${isBlocked ? 'blocked' : ''} ${isSunday ? 'sunday' : ''} ${isFirstSundayOfMonth ? 'catechesis-mass' : ''}">
                        <span class="event-text">${day.events[windowIndex]}</span>
                    </td>
                    <td class="${isBlocked ? 'blocked' : ''} ${isSunday ? 'sunday' : ''}">
                        <span class="time-text">${day.times[windowIndex]}</span>
                    </td>
                    <td>
                        <button class="edit-btn" onclick="toggleEdit(this, ${index}, '${windowId}')" ${isBlocked ? 'disabled' : ''}>Editar</button>
                        <button class="block-btn" onclick="toggleBlock(this, ${index}, '${windowId}')">${isBlocked ? 'Desbloquear' : 'Bloquear'}</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }

        function toggleEdit(button, index, windowId) {
            const row = button.closest('tr');
            const eventCell = row.children[2];
            const timeCell = row.children[3];
            const eventText = eventCell.querySelector('.event-text');
            const timeText = timeCell.querySelector('.time-text');
            const windowIndex = windows.findIndex(w => w.id === windowId);

            if (button.textContent === 'Editar') {
                const eventInput = document.createElement('input');
                eventInput.type = 'text';
                eventInput.className = 'event-input';
                eventInput.value = eventText.textContent;
                eventCell.replaceChild(eventInput, eventText);

                const timeInput = document.createElement('input');
                timeInput.type = 'text';
                timeInput.className = 'time-input';
                timeInput.value = timeText.textContent;
                timeCell.replaceChild(timeInput, timeText);

                button.textContent = 'Salvar';
            } else {
                const eventInput = eventCell.querySelector('.event-input');
                const timeInput = timeCell.querySelector('.time-input');
                
                const newEventText = document.createElement('span');
                newEventText.className = 'event-text';
                newEventText.textContent = eventInput.value;
                eventCell.replaceChild(newEventText, eventInput);

                const newTimeText = document.createElement('span');
                newTimeText.className = 'time-text';
                newTimeText.textContent = timeInput.value;
                timeCell.replaceChild(newTimeText, timeInput);

                button.textContent = 'Editar';

                calendar[index].events[windowIndex] = eventInput.value;
                calendar[index].times[windowIndex] = timeInput.value;
                localStorage.setItem('calendarData', JSON.stringify(calendar));
            }
        }

        function toggleBlock(button, index, windowId) {
            const row = button.closest('tr');
            const eventCell = row.children[2];
            const timeCell = row.children[3];
            const windowIndex = windows.findIndex(w => w.id === windowId);
            const isBlocked = calendar[index].blocked[windowIndex];

            calendar[index].blocked[windowIndex] = !isBlocked;
            eventCell.classList.toggle('blocked');
            timeCell.classList.toggle('blocked');
            button.textContent = isBlocked ? 'Bloquear' : 'Desbloquear';
            button.previousElementSibling.disabled = !isBlocked;

            localStorage.setItem('calendarData', JSON.stringify(calendar));
        }

        function searchEvents() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const allTables = document.querySelectorAll('table');
            
            allTables.forEach(table => {
                const rows = table.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const date = row.cells[0].textContent.toLowerCase();
                    const day = row.cells[1].textContent.toLowerCase();
                    const event = row.cells[2].textContent.toLowerCase();
                    const time = row.cells[3].textContent.toLowerCase();
                    
                    if (date.includes(searchTerm) || day.includes(searchTerm) || 
                        event.includes(searchTerm) || time.includes(searchTerm)) {
                        row.style.display = '';
                        highlightText(row, searchTerm);
                    } else {
                        row.style.display = 'none';
                        clearHighlight(row);
                    }
                });
            });
        }

        function highlightText(row, searchTerm) {
            const cellsToHighlight = [row.cells[0], row.cells[1], row.cells[2], row.cells[3]];
            cellsToHighlight.forEach(cell => {
                cell.innerHTML = cell.textContent.replace(
                    new RegExp(searchTerm, 'gi'),
                    match => `<span class="highlight">${match}</span>`
                );
            });
        }

        function clearHighlight(row) {
            const cellsToClear = [row.cells[0], row.cells[1], row.cells[2], row.cells[3]];
            cellsToClear.forEach(cell => {
                cell.innerHTML = cell.textContent;
            });
        }

        let calendar = JSON.parse(localStorage.getItem('calendarData')) || generateCalendar('2024-09-01', '2026-04-05');

        windows.forEach(window => renderCalendar(window.id, calendar));

        document.getElementById('search-button').addEventListener('click', searchEvents);
        document.getElementById('search-input').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                searchEvents();
            }
        });
    </script>
</body>
</html>